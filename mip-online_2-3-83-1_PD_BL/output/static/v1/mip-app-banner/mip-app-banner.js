define("mip-app-banner/mip-app-banner",["require","customElement","fetch-jsonp","viewer","util"],function(e){function t(){if(this.isSysBanner=c.isSafari()||c.isBaidu(),this.showSysBanner=!r.isIframed&&this.isSysBanner,this.showSysBanner)return!1;if(this.isEmbeddedSafari=r.isIframed&&this.isSysBanner,this.isEmbeddedSafari)return!1;if(this.metaTag=document.head.querySelector("meta[name=apple-itunes-app]"),!this.metaTag)return!1;else return!0}function i(){var e=this;if(!t.call(e))return void this.element.remove();this.openButton=this.element.querySelector("button[open-button]"),u.init(this.element);var i=this.metaTag.getAttribute("content"),n=i.replace(/\s/,"").split(","),o={};n.forEach(function(e){var t=e.split("=");o[t[0]]=t[1]});var a=o["app-id"],r=o["app-argument"],d="https://itunes.apple.com/us/app/id"+a,c=r||d;l.setup(this.openButton,c,d)}function n(){var e=this;if(!t.call(e))return void this.element.remove();this.openButton=this.element.querySelector("button[open-button]"),u.init(this.element),this.manifestLink=null,this.manifestHref="",this.missingDataSources=!1,this.manifestLink=document.head.querySelector("link[rel=manifest],link[rel=origin-manifest]");var i=c.isAndroid()&&c.isChrome(),n=!r.isIframed&&i;if(n)return void this.element.remove();if(this.missingDataSources=c.isAndroid()&&!this.manifestLink,this.missingDataSources)return void this.element.remove();if(this.manifestHref=this.manifestLink.getAttribute("href"),/http:\/\//.test(this.manifestHref))console.error("必须是https的连接");a(this.manifestHref).then(function(e){return e.json()}).then(function(t){var i=t.related_applications;if(!i)e.element.remove();for(var n=0;n<i.length;n++){var o=i[n];if("play"===o.platform){var a=o.install,r=o.open;l.setup(e.openButton,r,a)}}})}var o=e("customElement").create(),a=e("fetch-jsonp"),r=e("viewer"),d=e("util"),c=d.platform,l={setup:function(e,t,i){var n=this;e.addEventListener("click",function(){n.onClick(t,i)})},onClick:function(e,t){var i=setTimeout(function(){window.top.location.href=t,clearTimeout(i)},1500);window.open(e,"_top");var n=function(){var e=document.hidden||document.webkitHidden;e&&clearTimeout(i)};document.addEventListener("visibilitychange",n,!1),document.addEventListener("webkitvisibilitychange",n,!1),window.addEventListener("pagehide",function(){clearTimeout(i)},!1)}},s={getSotrageKey:function(e){return"mip-app-banner:"+e},hasItem:function(e){return!!localStorage.getItem(s.getSotrageKey(e))},setSotrage:function(e){localStorage.setItem(this.getSotrageKey(e),!0)}},p={element:null,add:function(e){this.element=e;var t=document.createElement("span");t.classList.add("mip-app-banner-dismiss-button"),t.addEventListener("click",this.onClick.bind(this)),e.appendChild(t)},onClick:function(){s.setSotrage(this.element.id),this.element.remove()}},u={isDismissed:function(e){return s.hasItem(e)},init:function(e){if(this.isDismissed(e.id))return void e.remove();else return d.css(e,{visibility:"visible"}),void p.add(e)}};return o.prototype.firstInviewCallback=function(){var e=this,t=e.element;if(u.isDismissed(t.id),d.css(this.element,{display:"",visibility:"hidden"}),e.openButton=null,e.canShowBanner=null,e.dismissButton=null,c.isIos())i.call(this);else n.call(this)},o}),define("mip-app-banner",["mip-app-banner/mip-app-banner"],function(e){return e}),function(){function e(e,t){e.registerMipElement("mip-app-banner",t,"mip-app-banner{position:fixed !important;bottom:0 !important;left:0;width:100%;max-height:100px !important;box-sizing:border-box;background:#fff;z-index:13 !important;box-shadow:0 0 5px 0 rgba(0,0,0,0.2) !important}.mip-app-banner-dismiss-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url('data:image/svg+xml;utf8,%3Csvg%20width%3D%2213px%22%20height%3D%2213px%22%20viewBox%3D%22341%208%2013%2013%22%20version%3D%221.1%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cg%20id%3D%22ic_close_black_24dp%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%20transform%3D%22translate%28341.000000%2C%208.000000%29%22%3E%3Cpolygon%20id%3D%22Shape%22%20fill%3D%22%234F4F4F%22%20points%3D%2213%201.30928571%2011.6907143%200%206.5%205.19071429%201.30928571%200%200%201.30928571%205.19071429%206.5%200%2011.6907143%201.30928571%2013%206.5%207.80928571%2011.6907143%2013%2013%2011.6907143%207.80928571%206.5%22%3E%3C/polygon%3E%3C/g%3E%3C/svg%3E');background-size:13px 13px;background-position:9px center;background-color:#fff;background-repeat:no-repeat;z-index:14 !important;box-shadow:0 0 5px 0 rgba(0,0,0,0.2);border:none}")}if(window.MIP)require(["mip-app-banner"],function(t){e(window.MIP,t)});else require(["mip","mip-app-banner"],e)}();