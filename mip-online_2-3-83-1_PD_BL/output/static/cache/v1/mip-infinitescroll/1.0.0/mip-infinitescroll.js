define("mip-infinitescroll/infinitescroll",["require","jquery"],function(t){var e=t("jquery"),i=function(t){if(t.$result&&t.$loading&&t.pushResult){var i=this;t.$result=e(t.$result),t.$loading=e(t.$loading),i.options=e.extend({$wrapper:e(window),$scroller:e("body"),firstResult:[],scrollPageClass:"mip-infinitescroll-page",loadingHtml:"加载中...",loadFailHtml:"加载失败,点击重试",loadOverHtml:"加载完毕",bufferHeightPx:10,pageResultNum:10,limitShowPn:2,preLoadPn:1},t),i._init()}};return i.prototype={version:"0.1.0",_init:function(){var t=this;if(t.eventSpace=".InfiniteScroll",t.state="start",t.scrollPageCache={topPosition:[],content:[]},t.dataStatus=1,t.currentLoadPage=t.options.firstResult.length?0:-1,t.currentShowPage=0,t._horizontalHack(),t.options.$loading.html(t.options.loadingHtml),t.options.firstResult.length)t.scrollPageCache.content=t.scrollPageCache.content.concat(t._separatePage(t.options.firstResult)),t.options.$result.html(t._wrapPageParentDom(t.scrollPageCache.content[0],0)),t.scrollPageCache.topPosition.push(t.options.$result.position().top);if(t.refresh(),e(window).on("resize"+t.eventSpace,function(){t.refresh()}),t._bindScroll(),!t.options.firstResult.length)t._scrollBottomFn()},refresh:function(){var t=this;if("pause"!==t.state)t.wrapperHeight=t.options.$wrapper.height(),t.scrollerHeight=t.options.$scroller.height(),t.currentScrollTop=t.options.$wrapper.scrollTop()},destroy:function(){var t=this;e(window).off("resize"+t.eventSpace),t.options.$wrapper.off("scroll"+t.eventSpace),t.options.$loading.off("click"+t.eventSpace),t.scrollPageCache=null},pause:function(){var t=this;if("pause"!==t.state)t.pauseScrollTop=t.currentScrollTop,t.state="pause"},start:function(){var t=this;if("start"!==t.state)t.options.$wrapper.scrollTop(t.pauseScrollTop),t.refresh(),t.state="start"},_horizontalHack:function(){var t,i=this;if(void 0!==window.orientation){if(0===window.orientation||180===window.orientation)t=Math.min(window.screen.width,e(window).width());else if(90===window.orientation||window.orientation===-90)t=Math.min(window.screen.width,window.screen.height),t=t*e(window).width()/Math.max(window.screen.width,window.screen.height)}else t=Math.min(window.screen.width,window.screen.height);i.options.$result.css({"max-width":t+"px"})},_bindScroll:function(){var t=this;if(t.options.$wrapper.on("scroll"+t.eventSpace,function(){if("pause"!==t.state){if(t.currentScrollTop=e(this).scrollTop(),t.wrapperHeight=t.options.$wrapper.height(),t.currentScrollTop<=0)t.options.onScrollTop&&t.options.onScrollTop.call(t);if(t.currentScrollTop>=t.scrollerHeight-t.wrapperHeight-t.options.bufferHeightPx)t._scrollBottomFn(),t.options.onScrollBottom&&t.options.onScrollBottom.call(t);var i=t.getShowPage();if(t.currentShowPage!==i)if(t.options.onChangeShowPN&&t.options.onChangeShowPN.call(t,i,t.currentShowPage),t.currentShowPage=i,t.options.limitShowPn)t._cycleScrollElement(i)}}),t.currentScrollTop>=t.scrollerHeight-t.wrapperHeight-t.options.bufferHeightPx)t.options.$wrapper.trigger("scroll")},_scrollBottomFn:function(){var t=this,i=t.currentLoadPage+1,n=t.scrollPageCache.content.length-1;if(i<=n)t._updateScrollElement(i),t.options.onLoadNewPage&&t.options.onLoadNewPage.call(t,i);if(1===t.dataStatus&&i+t.options.preLoadPn>=n){var o=t.options.pushResult.call(t,(n+1)*t.options.pageResultNum,n-i);t.dataStatus=2,e.when(o).then(function(e){if("NULL"===e)t.dataStatus=0,t.options.$loading.html(t.options.loadOverHtml);else if(e.length)t.dataStatus=1,t.scrollPageCache.content=t.scrollPageCache.content.concat(t._separatePage(e)),t.options.$wrapper.trigger("scroll")},function(){t.dataStatus=3,t.options.$loading.html(t.options.loadFailHtml).one("click"+t.eventSpace,function(){t.dataStatus=1,t.options.$loading.html(t.options.loadingHtml),t.options.$wrapper.trigger("scroll")})})}},_updateScrollElement:function(t){var i=this,n=e(i._wrapPageParentDom(i.scrollPageCache.content[t],t));i.options.$result.append(n),i.currentLoadPage=t,i.scrollerHeight=i.options.$scroller.height(),i.scrollPageCache.topPosition.push(n.position().top)},_cycleScrollElement:function(t){var i=this,n="infinite-recycle",o=Math.max(t-Math.floor((i.options.limitShowPn-1)/2),0),r=i.options.$result.find("."+i.options.scrollPageClass),s=r.slice(o,o+i.options.limitShowPn);if(s.length)s.each(function(){if(e(this).hasClass(n))e(this).html(i.scrollPageCache.content[e(this).attr("data-page")]),e(this).removeClass(n)}),r.not(s).not("."+n).each(function(){e(this).height(e(this).height()).empty(),e(this).addClass(n)}),i.scrollerHeight=i.options.$scroller.height()},_separatePage:function(t){var e=this;if(t.length){for(var i=e.options.pageResultNum,n=Math.ceil(t.length/i),o=[],r=0;r<n;r++)o.push(t.slice(r*i,r*i+i).join(""));return o}},_wrapPageParentDom:function(t,e){var i=this;return['<ul class="'+i.options.scrollPageClass+'" data-page="'+e+'">',t,"</ul>"].join("")},getShowPage:function(){for(var t=this,e=t.scrollPageCache.topPosition.concat(),i=e.length-1;i>=0;i--)if(t.currentScrollTop>=e[i])return i;return 0},constructor:i},i}),define("mip-infinitescroll/mip-infinitescroll",["require","customElement","templates","fetch-jsonp","./infinitescroll"],function(t){function e(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i];return t}function i(t){var e=this,i=t;if(t.indexOf("?")>0)i+="?"===t[t.length-1]?"":"&",i+=e.params.pnName+"="+e.params.pn;else i+="?"+e.params.pnName+"="+e.params.pn;return i}var n=t("customElement").create(),o=t("templates"),r=t("fetch-jsonp"),s=t("./infinitescroll"),a=null;return n.prototype.firstInviewCallback=function(){var t=this,n=t.element,l=n.getAttribute("data-src")||"";if(!l)return console.error("未填写src字段，不能获取数据"),void n.remove();t.params={rn:20,pn:6,pnName:"pn",bufferHeightPx:10,loadingHtml:"加载中...",loadFailHtml:"加载失败",loadOverHtml:"加载完毕!"};try{var c=n.querySelector('script[type="application/json"]');if(c)t.params=e(t.params,JSON.parse(c.textContent.toString()))}catch(t){return console.warn("json is illegal"),void console.warn(t)}t.url=i.call(t,l),t.pushResult=function(e,n){var s=$.Deferred();if(e>t.rn)s.resolve("NULL");else r(t.url,{jsonpCallback:"callback"}).then(function(t){return t.json()}).then(function(n){if(n&&!n.status&&n.data){if(e>t.params.rn||!n.data.items)s.resolve("NULL");o.render(t.element,n.data.items).then(function(t){s.resolve(t)}),t.params.pn++,t.url=i.call(t,l)}else s.resolve("NULL")});return s.promise()},a=new s({$result:n.querySelector(".mip-infinitescroll-results"),$loading:n.querySelector(".mip-infinitescroll-loading"),loadingHtml:t.params.loadingHtml,loadFailHtml:t.params.loadFailHtml,loadOverHtml:t.params.loadOverHtml,bufferHeightPx:t.params.bufferHeightPx,pageResultNum:t.params.pn,limitShowPn:0,preLoadPn:2,firstResult:[],pushResult:t.pushResult})},n.prototype.detachedCallback=function(){a=null},n}),define("mip-infinitescroll",["mip-infinitescroll/mip-infinitescroll"],function(t){return t}),function(){function t(t,e){t.registerMipElement("mip-infinitescroll",e)}if(window.MIP)require(["mip-infinitescroll"],function(e){t(window.MIP,e)});else require(["mip","mip-infinitescroll"],t)}();