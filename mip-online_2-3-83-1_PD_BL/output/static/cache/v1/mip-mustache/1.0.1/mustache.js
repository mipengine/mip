!function(t,e){if("object"==typeof exports&&exports&&"string"!=typeof exports.nodeName)e(exports);else if("function"==typeof define&&define.amd)define("mip-mustache/mustache",["exports"],e);else t.Mustache={},e(t.Mustache)}(this,function(t){function e(t){return"function"==typeof t}function i(t){return m(t)?"array":typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}function r(t,e){return g.call(t,e)}function s(t){return!r(v,t)}function a(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return y[t]})}function l(e,i){function o(){if(v&&!y)for(;g.length;)delete h[g.pop()];else g=[];v=!1,y=!1}function r(t){if("string"==typeof t)t=t.split(_,2);if(!m(t)||2!==t.length)throw new Error("Invalid tags: "+t);a=new RegExp(n(t[0])+"\\s*"),l=new RegExp("\\s*"+n(t[1])),p=new RegExp("\\s*"+n("}"+t[1]))}if(!e)return[];var a,l,p,f=[],h=[],g=[],v=!1,y=!1;r(i||t.tags);for(var j,T,A,S,E,C,P=new d(e);!P.eos();){if(j=P.pos,A=P.scanUntil(a))for(var O=0,M=A.length;O<M;++O){if(S=A.charAt(O),s(S))g.push(h.length);else y=!0;if(h.push(["text",S,j,j+1]),j+=1,"\n"===S)o()}if(!P.scan(a))break;if(v=!0,T=P.scan(k)||"name",P.scan(b),"="===T)A=P.scanUntil(w),P.scan(w),P.scanUntil(l);else if("{"===T)A=P.scanUntil(p),P.scan(x),P.scanUntil(l),T="&";else A=P.scanUntil(l);if(!P.scan(l))throw new Error("Unclosed tag at "+P.pos);if(E=[T,A,j,P.pos],h.push(E),"#"===T||"^"===T)f.push(E);else if("/"===T){if(C=f.pop(),!C)throw new Error('Unopened section "'+A+'" at '+j);if(C[1]!==A)throw new Error('Unclosed section "'+C[1]+'" at '+j)}else if("name"===T||"{"===T||"&"===T)y=!0;else if("="===T)r(A)}if(C=f.pop())throw new Error('Unclosed section "'+C[1]+'" at '+P.pos);return u(c(h))}function c(t){for(var e,i,n=[],o=0,r=t.length;o<r;++o)if(e=t[o])if("text"===e[0]&&i&&"text"===i[0])i[1]+=e[1],i[3]=e[3];else n.push(e),i=e;return n}function u(t){for(var e,i,n=[],o=n,r=[],s=0,a=t.length;s<a;++s)switch(e=t[s],e[0]){case"#":case"^":o.push(e),r.push(e),o=e[4]=[];break;case"/":i=r.pop(),i[5]=e[2],o=r.length>0?r[r.length-1][4]:n;break;default:o.push(e)}return n}function d(t){this.string=t,this.tail=t,this.pos=0}function p(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function f(){this.cache={}}var h=Object.prototype.toString,m=Array.isArray||function(t){return"[object Array]"===h.call(t)},g=RegExp.prototype.test,v=/\S/,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},b=/\s*/,_=/\s+/,w=/\s*=/,x=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;d.prototype.eos=function(){return""===this.tail},d.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var i=e[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i},d.prototype.scanUntil=function(t){var e,i=this.tail.search(t);switch(i){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=e.length,e},p.prototype.push=function(t){return new p(t,this)},p.prototype.lookup=function(t){var i,n=this.cache;if(n.hasOwnProperty(t))i=n[t];else{for(var r,s,a=this,l=!1;a;){if(t.indexOf(".")>0)for(i=a.view,r=t.split("."),s=0;null!=i&&s<r.length;){if(s===r.length-1)l=o(i,r[s]);i=i[r[s++]]}else i=a.view[t],l=o(a.view,t);if(l)break;a=a.parent}n[t]=i}if(e(i))i=i.call(this.view);return i},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(t,e){var i=this.cache,n=i[t];if(null==n)n=i[t]=l(t,e);return n},f.prototype.render=function(t,e,i){var n=this.parse(t),o=e instanceof p?e:new p(e);return this.renderTokens(n,o,i,t)},f.prototype.renderTokens=function(t,e,i,n){for(var o,r,s,a="",l=0,c=t.length;l<c;++l){if(s=void 0,o=t[l],r=o[0],"#"===r)s=this.renderSection(o,e,i,n);else if("^"===r)s=this.renderInverted(o,e,i,n);else if(">"===r)s=this.renderPartial(o,e,i,n);else if("&"===r)s=this.unescapedValue(o,e);else if("name"===r)s=this.escapedValue(o,e);else if("text"===r)s=this.rawValue(o);if(void 0!==s)a+=s}return a},f.prototype.renderSection=function(t,i,n,o){function r(t){return s.render(t,i,n)}var s=this,a="",l=i.lookup(t[1]);if(l){if(m(l))for(var c=0,u=l.length;c<u;++c)a+=this.renderTokens(t[4],i.push(l[c]),n,o);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)a+=this.renderTokens(t[4],i.push(l),n,o);else if(e(l)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");if(l=l.call(i.view,o.slice(t[3],t[5]),r),null!=l)a+=l}else a+=this.renderTokens(t[4],i,n,o);return a}},f.prototype.renderInverted=function(t,e,i,n){var o=e.lookup(t[1]);if(!o||m(o)&&0===o.length)return this.renderTokens(t[4],e,i,n)},f.prototype.renderPartial=function(t,i,n){if(n){var o=e(n)?n(t[1]):n[t[1]];if(null!=o)return this.renderTokens(this.parse(o),i,n,o);else return}},f.prototype.unescapedValue=function(t,e){var i=e.lookup(t[1]);if(null!=i)return i},f.prototype.escapedValue=function(e,i){var n=i.lookup(e[1]);if(null!=n)return t.escape(n)},f.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.3.0",t.tags=["{{","}}"];var j=new f;return t.clearCache=function(){return j.clearCache()},t.parse=function(t,e){return j.parse(t,e)},t.render=function(t,e,n){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+i(t)+'" was given as the first argument for mustache#render(template, view, partials)');return j.render(t,e,n)},t.to_html=function(i,n,o,r){var s=t.render(i,n,o);if(e(r))r(s);else return s},t.escape=a,t.Scanner=d,t.Context=p,t.Writer=f,t});